<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finance Planner â€“ Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body id="dashboard-page">
  <!-- Navigation Bar -->
  <nav class="navbar">
    <h1>Finance Planner</h1>
    <div class="nav-links">
      <a href="#overview">Overview</a>
      <a href="#budgets">Budgets</a>
      <a href="#expenses">Expenses</a>
      <a href="#goals">Goals</a>
      <a href="#calculators">Calculators</a>
      <button id="logout-btn" class="btn-secondary logout">Logout</button>
    </div>
  </nav>

  <div class="container">
    <!-- Overview Section -->
    <section id="overview" class="section">
      <div class="card">
        <h2>Welcome!</h2>
        <p>This dashboard gives you a snapshot of your budgets, expenses and goals.</p>
      </div>
      <div class="card chart-container">
        <canvas id="overviewChart"></canvas>
      </div>
      <div class="card chart-container">
        <canvas id="goalsChart"></canvas>
      </div>
    </section>

    <!-- Budgets Section -->
    <section id="budgets" class="section">
      <div class="card">
        <h2>Budgets</h2>
        <form id="budget-form">
          <input type="text" id="budget-name" placeholder="Budget Category" required />
          <input type="number" step="0.01" id="budget-amount" placeholder="Amount" required />
          <button type="submit">Add Budget</button>
        </form>
        <table>
          <thead>
            <tr><th>Category</th><th>Amount ($)</th><th>Action</th></tr>
          </thead>
          <tbody id="budgetsTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Expenses Section -->
    <section id="expenses" class="section">
      <div class="card">
        <h2>Expenses</h2>
        <form id="expense-form">
          <input type="text" id="expense-name" placeholder="Expense Description" required />
          <select id="expense-category" required>
            <option value="" disabled selected>Select Category</option>
          </select>
          <input type="number" step="0.01" id="expense-amount" placeholder="Amount" required />
          <button type="submit">Add Expense</button>
        </form>
        <table>
          <thead>
            <tr><th>Description</th><th>Category</th><th>Amount ($)</th><th>Date</th><th>Action</th></tr>
          </thead>
          <tbody id="expensesTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Goals Section -->
    <section id="goals" class="section">
      <div class="card">
        <h2>Goals</h2>
        <form id="goal-form">
          <input type="text" id="goal-name" placeholder="Goal Name" required />
          <input type="number" step="0.01" id="goal-target" placeholder="Target Amount" required />
          <button type="submit">Add Goal</button>
        </form>
        <table>
          <thead>
            <tr><th>Name</th><th>Target ($)</th><th>Progress</th><th>Action</th></tr>
          </thead>
          <tbody id="goalsTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Calculators Section -->
    <section id="calculators" class="section">
      <div class="card">
        <h2>Savings Calculator</h2>
        <form>
          <input type="number" step="0.01" id="calc-principal" placeholder="Initial Amount ($)" required />
          <input type="number" step="0.01" id="calc-monthly" placeholder="Monthly Contribution ($)" required />
          <input type="number" step="0.01" id="calc-rate" placeholder="Annual Interest Rate (%)" required />
          <input type="number" step="0.1" id="calc-years" placeholder="Years" required />
          <button id="calc-btn">Calculate</button>
        </form>
        <p id="calc-result"></p>
      </div>
      <div class="card">
        <h2>Budget Calculator</h2>
        <form>
          <input type="number" step="0.01" id="budget-income" placeholder="Monthly Income ($)" required />
          <input type="number" step="0.01" id="budget-expense" placeholder="Monthly Expenses ($)" required />
          <button id="budget-btn">Calculate</button>
        </form>
        <p id="budget-result"></p>
      </div>
    </section>
  </div>
  <script src="script.js"></script>
  <script>
    // Populate expense category dropdown based on budgets
    function populateExpenseCategories() {
      const data = getUserData();
      const select = document.getElementById('expense-category');
      // Remove existing options except placeholder
      select.innerHTML = '<option value="" disabled selected>Select Category</option>';
      data.budgets.forEach((budget) => {
        const opt = document.createElement('option');
        opt.value = budget.name;
        opt.textContent = budget.name;
        select.appendChild(opt);
      });
    }
    // When budgets change, update categories dropdown
    document.addEventListener('DOMContentLoaded', () => {
      // call once at load after budgets are loaded
      setTimeout(populateExpenseCategories, 200);
      // override functions to also update categories on adding or deleting budgets
      const originalAddBudget = window.addBudget;
      window.addBudget = function(name, amount) {
        originalAddBudget(name, amount);
        populateExpenseCategories();
      };
      window.deleteBudget = function(index) {
        const data = getUserData();
        data.budgets.splice(index, 1);
        updateUserData(data);
        populateBudgets();
        populateExpenseCategories();
        updateCharts();
      };
    });
  </script>
</body>
</html>